import 'package:flutter/material.dart';
import 'package:homecare0x1/constants.dart';
import 'package:homecare0x1/user_provider.dart';
import 'package:homecare0x1/widgets/common/dashboard_card.dart';
import 'package:homecare0x1/widgets/common/modern_screen_layout.dart';
import 'package:homecare0x1/widgets/common/stats_card.dart';
import 'package:provider/provider.dart';

class CaregiverDashboardScreen extends StatelessWidget {
  const CaregiverDashboardScreen({super.key});

  Future<bool> _confirmLogout(BuildContext context) async {
    return await showDialog<bool>(
          context: context,
          builder: (context) => AlertDialog(
            title: const Text('Logout'),
            content: const Text('Are you sure you want to log out?'),
            actions: [
              TextButton(
                onPressed: () => Navigator.pop(context, false),
                child: const Text('Cancel'),
              ),
              TextButton(
                onPressed: () => Navigator.pop(context, true),
                child: const Text('Logout'),
              ),
            ],
          ),
        ) ??
        false;
  }

  @override
  Widget build(BuildContext context) {
    final userProvider = Provider.of<UserProvider>(context);
    final userName = userProvider.user?.name ?? 'Caregiver';

    return ModernScreenLayout(
      title: 'Caregiver Dashboard',
      showBackButton: true,
      onBackPressed: () async {
        if (await _confirmLogout(context)) {
          userProvider.clearUser();
          Navigator.pushReplacementNamed(context, Routes.login);
        }
      },
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              'Welcome, $userName',
              style: Theme.of(context).textTheme.headlineMedium,
            ),
            const SizedBox(height: 8),
            Text(
              'Your caregiving tasks for today',
              style: Theme.of(context).textTheme.bodyLarge,
            ),
            const SizedBox(height: 24),
            const StatsCard(
              title: 'Tasks Completed',
              value: '8',
              icon: Icons.check_circle,
            ),
            const StatsCard(
              title: 'Upcoming Tasks',
              value: '3',
              icon: Icons.schedule,
            ),
            const StatsCard(
              title: 'Clients Assigned',
              value: '5',
              icon: Icons.people,
            ),
            const SizedBox(height: 24),
            DashboardCard(
              title: 'Client List',
              icon: Icons.person,
              onTap: () => Navigator.pushNamed(context, Routes.clientList),
            ),
            DashboardCard(
              title: 'Task List',
              icon: Icons.task,
              onTap: () => Navigator.pushNamed(context, Routes.taskList),
            ),
            DashboardCard(
              title: 'Messages',
              icon: Icons.message,
              onTap: () => Navigator.pushNamed(context, Routes.messages),
            ),
            DashboardCard(
              title: 'Check-In',
              icon: Icons.login,
              onTap: () => Navigator.pushNamed(context, Routes.visitCheckIn),
            ),
          ],
        ),
      ),
    );
  }
}
